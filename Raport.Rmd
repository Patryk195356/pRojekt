---
title: "Czynniki wpływające na przebieg choroby nowotworowej"
author: "Patryk Woźniak, Iga Tumanik, Aleksandra Pellowska"
date: "`r Sys.Date()`"
output:
  rmdformats::material:
    highlight: kate
    #toc: true
    #toc_depth: 3
    self_contained: true
    number_sections: true
    code_folding: show
    fig_width: 8
    fig_height: 5
    fig_caption: true
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
dane <- read.csv("cancer patient data sets.csv")
dane
library(tidyverse)

library(naniar)

library(validate)

library(validatetools)

library(dcmodify)

library(errorlocate)

dane$Gender <- factor(dane$Gender,
                      levels = c(1, 2),
                      labels = c("mężczyzna", "kobieta"))

```


# Wprowadzenie 

Celem naszego projektu jest analiza zbioru danych dotyczących pacjentów z rakiem płuc. Zbiór danych zawiera informacje demograficzne, kliniczne oraz wyniki leczenia pacjentów. W ramach analizy przeprowadzimy eksploracyjną analizę danych (EDA), a także zastosujemy różne metody statystyczne i uczenia maszynowego w celu zidentyfikowania czynników wpływających na przebieg choroby oraz prognozowania wyników leczenia. Zbiór danych zawiera `r nrow(dane)` wierszy oraz `r ncol(dane)` kolumn.

## Opis danych 

W danych uwzględniono m.in. wiek i płeć pacjentów, czynniki stylu życia takie jak palenie tytoniu, bierne palenie, spożycie alkoholu, dieta oraz występowanie otyłości. Zbiór obejmuje również informacje o narażeniu środowiskowym i zawodowym, w tym poziom zanieczyszczenia powietrza, alergię na kurz oraz ekspozycję zawodową. Dodatkowo uwzględniono objawy kliniczne i choroby współistniejące, takie jak przewlekła choroba płuc, kaszel z krwią, duszność, zmęczenie czy utrata masy ciała. Zmienną wynikową jest poziom zaawansowania choroby nowotworowej, sklasyfikowany jako niski (Low), średni (Medium) lub wysoki (High). Zebrane dane umożliwiają analizę zależności pomiędzy czynnikami ryzyka a stopniem zaawansowania choroby oraz ich graficzną prezentację.

## Problemy badawcze

### Główny problem badawczy

Jakie czynniki demograficzne, środowiskowe oraz związane ze stylem życia mają wpływ na poziom zaawansowania choroby nowotworowej u badanych pacjentów?

### Szczegółowe problemy badawcze

1. Jaki jest rozkład poziomu zaawansowania choroby nowotworowej (Low, Medium, High) w badanej grupie pacjentów?

2. Czy poziom zaawansowania choroby nowotworowej różni się w zależności od płci pacjentów?

3. Czy wiek pacjentów ma związek z poziomem zaawansowania choroby nowotworowej?

4. Czy palenie tytoniu wpływa na poziom zaawansowania choroby nowotworowej?

5. Czy występowanie wybranych objawów klinicznych (np. kaszel z krwią, duszność, zmęczenie) wiąże się z wyższym poziomem choroby?

# Data Wrangling

## Braki danych

```{r echo=FALSE}
procent <- prop_complete_var(dane)*100

```


W danych znajduje się `r procent` % kompletnych wartości 
```{r echo=FALSE}
naniar::vis_miss(dane)
gg_miss_fct(x=dane, fct=Gender)
```

## Wzorzec braków danych

```{r echo=FALSE}
library(finalfit)
missing_pattern(dane)
```
## Walidacja danych

Czy wiek <= 120?

```{r echo=FALSE}
reguly <- validator(
  Age >0 , Age <120)
```

```{r echo=FALSE}
cf<- confront(dane, reguly, key="index")
summary(cf)
barplot(cf)
```

# Wizualizacja danych

## Charakterystyka badanej grupy

Płeć
```{r echo=FALSE}
ggplot(dane, aes(x = Gender)) +
  geom_bar(fill = "#5FB3A2", color = "grey30") +
  labs(
    title = "Rozkład płci w badanej grupie pacjentów",
    x = "Płeć",
    y = "Liczba pacjentów"
  )
```

Rozkład wieku 
```{r echo=FALSE}
ggplot(dane, aes(x = Age)) +
  geom_histogram(bins = 20) +
  theme_minimal()
```

Poziom zaawansowania choroby 

```{r echo=FALSE}
ggplot(dane, aes(x = Level)) +
  geom_bar() +
  labs(
    title = "Poziom zaawansowania nowotworu w badanej grupie pacjentów",
    x = "Zaawansowanie choroby",
    y = "Liczba pacjentów"
  ) +
  theme_minimal()
```

## Główny problem badawczy: 

Jakie czynniki demograficzne, środowiskowe oraz związane ze stylem życia mają wpływ na poziom zaawansowania choroby?

**Płeć**
```{r echo=FALSE}
ggplot(dane, aes(x = Gender, fill = Level)) +
  geom_bar(position = "fill") +
  theme_minimal()
```

**Zanieczyszczenie powietrza**
```{r echo=FALSE}
ggplot(dane, aes(x = Air.Pollution, fill = Level)) +
  geom_bar(position = "fill") +
  theme_minimal()
```
**Palenie**
```{r echo=FALSE}
ggplot(dane, aes(x = Smoking, fill = Level)) +
  geom_bar(position = "fill") +
  theme_minimal()
```
**Otyłość**
```{r echo=FALSE}
ggplot(dane, aes(x = Obesity, fill = Level)) +
  geom_bar(position = "fill") +
  theme_minimal()
```

## Szczegółowe problemy badawcze:

**Rozkład poziomu zaawansowania choroby**
``` {r echo=FALSE}
ggplot(dane, aes(x = Level)) +
  geom_bar() +
  labs(
    title = "Rozkład poziomu zaawansowania choroby nowotworowej",
    x = "Poziom choroby",
    y = "Liczba pacjentów"
  ) +
  theme_minimal()
```
Z wykresu wynika że najwięcej pacjentów znajduje się w grupie o wysokim poziomie zaawansowania choroby nowotworowej


**Zaawansowanie choroby a płeć**
```{r echo=FALSE}
ggplot(dane, aes(x = Gender, fill = Level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Poziom choroby a płeć pacjentów",
    x = "Płeć",
    y = "Udział poziomów choroby"
  ) +
  theme_minimal()
```
U kobiet występuje większa równowaga między różnymi etapami choroby, podczas gdy u mężczyzn przeważa zaawansowany poziom choroby.


**Zaawansowanie choroby a wiek**
```{r echo=FALSE}
ggplot(dane, aes(x = Level, y = Age, fill = Level)) +
  geom_boxplot() +
  labs(
    title = "Wiek pacjentów a poziom zaawansowania choroby",
    x = "Poziom choroby",
    y = "Wiek"
  ) +
  theme_minimal()
```
Pacjenci z zaawansowanym rakiem płuc są średnio młodsi, co może sugerować, że choroba może rozwijać się szybciej u młodszych osób lub występować w bardziej agresywnej formie.
Pacjenci z 'low level' są średnio starsi, co może wskazywać, że choroba u starszych osób rozwija się wolniej lub mają one łagodniejszy przebieg choroby


**Wpływ palenia na poziom zaawansowania nowotworu**
``` {r echo=FALSE}
ggplot(dane, aes(x = Smoking, fill = Level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Palenie tytoniu a poziom choroby nowotworowej",
    x = "Poziom palenia",
    y = "Udział poziomów choroby"
  ) +
  theme_minimal()
```
Z wykresu wynika że intensywniejsze palenie tytoniu wiąże się z wyższym zaawansowaniem nowotworu.

**Objawy towarzyszące a zaawansowanie choroby - Kaszel z krwią**
```{r echo=FALSE}
ggplot(dane, aes(x = Level, y = as.numeric(Coughing.of.Blood))) +
  geom_boxplot() +
  labs(
    title = "Kaszel z krwią a poziom choroby",
    x = "Poziom choroby",
    y = "Nasilenie kaszlu z krwią"
  ) +
  theme_minimal()
```
Wykres przedstawia, że nasilenie występowania kaszlu z krwią rośnie wraz z poziomem nasilenia choroby, szczególnie w grupach o średnim i wysokim zaawansowaniu, gdzie objaw ten jest bardziej wyraźny i zmienny.


**Zmęczenie a poziom zaawansowania choroby**
```{r echo=FALSE}
ggplot(dane, aes(x = Fatigue, fill = Level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Zmęczenie a poziom choroby",
    x = "Poziom zmęczenia",
    y = "Udział poziomów choroby"
  ) +
  theme_minimal()
```
Zmęczenie może być wskaźnikiem nasilenia choroby co sugeruje związek między rosnącym poziomem zmęczenia a zaawansowaniem choroby.



**Duszności**
```{r echo=FALSE}
ggplot(dane, aes(x = as.numeric(Shortness.of.Breath), fill = Level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Duszności a poziom choroby",
    x = "Częstość duszności",
    y = "Udział poziomów choroby"
  ) +
  theme_minimal()
```
Wraz ze wzrostem częstotliwości duszności, zwiększa się odsetek osób z zaawansowanym poziomem choroby. Wskazuje to na związek między nasileniem duszności a pogarszającym się stanem zdrowia pacjentów.